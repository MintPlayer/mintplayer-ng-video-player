{"version":3,"file":"mintplayer-ng-video-player.mjs","sources":["../../../../../frameworks/ng-video-player/src/lib/components/video-player/video-player.component.ts","../../../../../frameworks/ng-video-player/src/lib/components/video-player/video-player.component.html","../../../../../frameworks/ng-video-player/src/mintplayer-ng-video-player.ts"],"sourcesContent":["import { AfterViewInit, Component, DestroyRef, ElementRef, EventEmitter, Inject, InjectionToken, Input, ModuleWithProviders, NgZone, OnDestroy, Output, StaticProvider, Type, ViewChild } from '@angular/core';\r\nimport { takeUntilDestroyed } from '@angular/core/rxjs-interop';\r\nimport { PlayerProgress } from '@mintplayer/player-progress';\r\nimport { ApiLoader, ECapability, EPlayerState, IApiService } from '@mintplayer/player-provider';\r\nimport { VideoPlayer, fromVideoEvent } from \"@mintplayer/video-player\";\r\n\r\nconst VIDEO_APIS = new InjectionToken<IApiService>('VideoApis');\r\n\r\nexport function provideVideoApis(...platforms: ApiLoader[]): StaticProvider {\r\n  return {\r\n    provide: VIDEO_APIS,\r\n    useFactory: () => Promise.all(platforms.map(loader => loader())),\r\n  }\r\n}\r\n\r\n@Component({\r\n  selector: 'video-player',\r\n  templateUrl: './video-player.component.html',\r\n  styleUrls: ['./video-player.component.scss'],\r\n  standalone: true\r\n})\r\nexport class VideoPlayerComponent implements AfterViewInit, OnDestroy {\r\n\r\n  constructor(\r\n    private zone: NgZone,\r\n    @Inject(VIDEO_APIS) private apis: Promise<IApiService[]>,\r\n    private destroy: DestroyRef,\r\n  ) { }\r\n\r\n  private zoneEmit<T>(emitter: EventEmitter<T>, value?: T) {\r\n    this.zone.run(() => emitter.emit(value));\r\n  }\r\n\r\n  //#region width\r\n  get width() {\r\n    return this.player?.width || 300;\r\n  }\r\n  @Input() set width(value: number) {\r\n    if (this.player) {\r\n      this.player.width = value;\r\n    }\r\n  }\r\n  //#endregion\r\n  //#region height\r\n  get height() {\r\n    return this.player?.height || 200;\r\n  }\r\n  @Input() set height(value: number) {\r\n    if (this.player) {\r\n      this.player.height = value;\r\n    }\r\n  }\r\n  //#endregion\r\n  //#region progress\r\n  @Output() public progressChange = new EventEmitter<PlayerProgress>();\r\n  //#endregion\r\n  //#region playerState\r\n  @Input() set playerState(value: EPlayerState) {\r\n    if (this.player) {\r\n      this.player.playerState = value;\r\n    }\r\n  }\r\n  @Output() public playerStateChange = new EventEmitter<EPlayerState>();\r\n  //#endregion\r\n  //#region title\r\n  public getTitle() {\r\n    return new Promise<string | null>((resolve) => {\r\n      if (this.player) {\r\n        this.player.getTitle().then(t => resolve(t));\r\n      } else {\r\n        resolve(null);\r\n      }\r\n    });\r\n  }\r\n  //#endregion\r\n  //#region volume\r\n  get volume() {\r\n    return this.player?.volume ?? 50;\r\n  }\r\n  @Input() set volume(value: number) {\r\n    if (this.player) {\r\n      this.player.volume = value;\r\n    }\r\n  }\r\n  @Output() public volumeChange = new EventEmitter<number>();\r\n  //#endregion\r\n  //#region mute\r\n  get mute() {\r\n    return this.player?.mute ?? false;\r\n  }\r\n  @Input() set mute(value: boolean) {\r\n    if (this.player) {\r\n      this.player.mute = value;\r\n    }\r\n  }\r\n  @Output() public muteChange = new EventEmitter<boolean>();\r\n  //#endregion\r\n\r\n  //#region isFullscreen\r\n  get isFullscreen() {\r\n    return this.player?.isFullscreen ?? false;\r\n  }\r\n  @Input() set isFullscreen(value: boolean) {\r\n    if (this.player) {\r\n      this.player.isFullscreen = value;\r\n    }\r\n  }\r\n  @Output() public isFullscreenChange = new EventEmitter<boolean>();\r\n  //#endregion\r\n  //#region isPip\r\n  get isPip() {\r\n    return this.player?.isPip ?? false;\r\n  }\r\n  @Input() set isPip(value: boolean) {\r\n    if (this.player) {\r\n      this.player.isPip = value;\r\n    }\r\n  }\r\n  @Output() public isPipChange = new EventEmitter<boolean>();\r\n  public setIsPip(isPip: boolean) {\r\n    // Vimeo pip requests must originate from a user gesture.\r\n    // Hence why we can't make it a bindable property.\r\n    // Sadly, even with this approach, the browser seems to think the event wasn't user initiated when the iframe isn't focused.\r\n    if (this.player) {\r\n      this.player.isPip = isPip;\r\n    }\r\n  }\r\n  //#endregion\r\n  //#region autoplay\r\n  public get autoplay() {\r\n    return this.player?.autoplay || false;\r\n  }\r\n  @Input() public set autoplay(value: boolean) {\r\n    if (this.player) {\r\n      this.player.autoplay = value;\r\n    }\r\n  }\r\n  //#endregion\r\n  //#region url\r\n  public get url() {\r\n    return this.player?.url || '';\r\n  }\r\n  @Input() public set url(value: string) {\r\n    this.setUrl(value);\r\n  }\r\n  public setUrl(url: string | null) {\r\n    if (this.player) {\r\n      this.player.url = url;\r\n    }\r\n  }\r\n  //#endregion\r\n\r\n  @Output() capabilitiesChange = new EventEmitter<ECapability[]>();\r\n\r\n  @ViewChild('container') container!: ElementRef<HTMLDivElement>;\r\n\r\n  player?: VideoPlayer;\r\n  ngAfterViewInit() {\r\n    this.apis.then((apis) => {\r\n      this.player = new VideoPlayer(this.container.nativeElement, apis);\r\n      fromVideoEvent(this.player, 'stateChange').pipe(takeUntilDestroyed(this.destroy))\r\n        .subscribe(([state]) => this.zoneEmit(this.playerStateChange, state));\r\n      fromVideoEvent(this.player, 'isPipChange').pipe(takeUntilDestroyed(this.destroy))\r\n        .subscribe(([isPip]) => this.zoneEmit(this.isPipChange, isPip));\r\n      fromVideoEvent(this.player, 'isFullscreenChange').pipe(takeUntilDestroyed(this.destroy))\r\n        .subscribe(([isFullscreen]) => this.zoneEmit(this.isFullscreenChange, isFullscreen));\r\n      fromVideoEvent(this.player, 'muteChange').pipe(takeUntilDestroyed(this.destroy))\r\n        .subscribe(([mute]) => this.zoneEmit(this.muteChange, mute));\r\n      fromVideoEvent(this.player, 'volumeChange').pipe(takeUntilDestroyed(this.destroy))\r\n        .subscribe(([volume]) => this.zoneEmit(this.volumeChange, volume));\r\n      fromVideoEvent(this.player, 'capabilitiesChange').pipe(takeUntilDestroyed(this.destroy))\r\n        .subscribe(([capabilities]) => this.zoneEmit(this.capabilitiesChange, capabilities));\r\n      fromVideoEvent(this.player, 'progressChange').pipe(takeUntilDestroyed(this.destroy))\r\n        .subscribe(([progress]) => this.zoneEmit(this.progressChange, progress));\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.player?.destroy();\r\n  }\r\n}\r\n","<div #container></div>","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":";;;;;;AAMA,MAAM,UAAU,GAAG,IAAI,cAAc,CAAc,WAAW,CAAC,CAAC;AAEhD,SAAA,gBAAgB,CAAC,GAAG,SAAsB,EAAA;IACxD,OAAO;AACL,QAAA,OAAO,EAAE,UAAU;AACnB,QAAA,UAAU,EAAE,MAAM,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,GAAG,CAAC,MAAM,IAAI,MAAM,EAAE,CAAC,CAAC;KACjE,CAAA;AACH,CAAC;MAQY,oBAAoB,CAAA;AAE/B,IAAA,WAAA,CACU,IAAY,EACQ,IAA4B,EAChD,OAAmB,EAAA;QAFnB,IAAI,CAAA,IAAA,GAAJ,IAAI,CAAQ;QACQ,IAAI,CAAA,IAAA,GAAJ,IAAI,CAAwB;QAChD,IAAO,CAAA,OAAA,GAAP,OAAO,CAAY;;;AA4BZ,QAAA,IAAA,CAAA,cAAc,GAAG,IAAI,YAAY,EAAkB,CAAC;AAQpD,QAAA,IAAA,CAAA,iBAAiB,GAAG,IAAI,YAAY,EAAgB,CAAC;AAsBrD,QAAA,IAAA,CAAA,YAAY,GAAG,IAAI,YAAY,EAAU,CAAC;AAW1C,QAAA,IAAA,CAAA,UAAU,GAAG,IAAI,YAAY,EAAW,CAAC;AAYzC,QAAA,IAAA,CAAA,kBAAkB,GAAG,IAAI,YAAY,EAAW,CAAC;AAWjD,QAAA,IAAA,CAAA,WAAW,GAAG,IAAI,YAAY,EAAW,CAAC;;AAkCjD,QAAA,IAAA,CAAA,kBAAkB,GAAG,IAAI,YAAY,EAAiB,CAAC;KA7H5D;IAEG,QAAQ,CAAI,OAAwB,EAAE,KAAS,EAAA;AACrD,QAAA,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;KAC1C;;AAGD,IAAA,IAAI,KAAK,GAAA;AACP,QAAA,OAAO,IAAI,CAAC,MAAM,EAAE,KAAK,IAAI,GAAG,CAAC;KAClC;IACD,IAAa,KAAK,CAAC,KAAa,EAAA;AAC9B,QAAA,IAAI,IAAI,CAAC,MAAM,EAAE;AACf,YAAA,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,KAAK,CAAC;SAC3B;KACF;;;AAGD,IAAA,IAAI,MAAM,GAAA;AACR,QAAA,OAAO,IAAI,CAAC,MAAM,EAAE,MAAM,IAAI,GAAG,CAAC;KACnC;IACD,IAAa,MAAM,CAAC,KAAa,EAAA;AAC/B,QAAA,IAAI,IAAI,CAAC,MAAM,EAAE;AACf,YAAA,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,KAAK,CAAC;SAC5B;KACF;;;IAMD,IAAa,WAAW,CAAC,KAAmB,EAAA;AAC1C,QAAA,IAAI,IAAI,CAAC,MAAM,EAAE;AACf,YAAA,IAAI,CAAC,MAAM,CAAC,WAAW,GAAG,KAAK,CAAC;SACjC;KACF;;;IAIM,QAAQ,GAAA;AACb,QAAA,OAAO,IAAI,OAAO,CAAgB,CAAC,OAAO,KAAI;AAC5C,YAAA,IAAI,IAAI,CAAC,MAAM,EAAE;AACf,gBAAA,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,IAAI,CAAC,CAAC,IAAI,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;aAC9C;iBAAM;gBACL,OAAO,CAAC,IAAI,CAAC,CAAC;aACf;AACH,SAAC,CAAC,CAAC;KACJ;;;AAGD,IAAA,IAAI,MAAM,GAAA;AACR,QAAA,OAAO,IAAI,CAAC,MAAM,EAAE,MAAM,IAAI,EAAE,CAAC;KAClC;IACD,IAAa,MAAM,CAAC,KAAa,EAAA;AAC/B,QAAA,IAAI,IAAI,CAAC,MAAM,EAAE;AACf,YAAA,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,KAAK,CAAC;SAC5B;KACF;;;AAID,IAAA,IAAI,IAAI,GAAA;AACN,QAAA,OAAO,IAAI,CAAC,MAAM,EAAE,IAAI,IAAI,KAAK,CAAC;KACnC;IACD,IAAa,IAAI,CAAC,KAAc,EAAA;AAC9B,QAAA,IAAI,IAAI,CAAC,MAAM,EAAE;AACf,YAAA,IAAI,CAAC,MAAM,CAAC,IAAI,GAAG,KAAK,CAAC;SAC1B;KACF;;;AAKD,IAAA,IAAI,YAAY,GAAA;AACd,QAAA,OAAO,IAAI,CAAC,MAAM,EAAE,YAAY,IAAI,KAAK,CAAC;KAC3C;IACD,IAAa,YAAY,CAAC,KAAc,EAAA;AACtC,QAAA,IAAI,IAAI,CAAC,MAAM,EAAE;AACf,YAAA,IAAI,CAAC,MAAM,CAAC,YAAY,GAAG,KAAK,CAAC;SAClC;KACF;;;AAID,IAAA,IAAI,KAAK,GAAA;AACP,QAAA,OAAO,IAAI,CAAC,MAAM,EAAE,KAAK,IAAI,KAAK,CAAC;KACpC;IACD,IAAa,KAAK,CAAC,KAAc,EAAA;AAC/B,QAAA,IAAI,IAAI,CAAC,MAAM,EAAE;AACf,YAAA,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,KAAK,CAAC;SAC3B;KACF;AAEM,IAAA,QAAQ,CAAC,KAAc,EAAA;;;;AAI5B,QAAA,IAAI,IAAI,CAAC,MAAM,EAAE;AACf,YAAA,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,KAAK,CAAC;SAC3B;KACF;;;AAGD,IAAA,IAAW,QAAQ,GAAA;AACjB,QAAA,OAAO,IAAI,CAAC,MAAM,EAAE,QAAQ,IAAI,KAAK,CAAC;KACvC;IACD,IAAoB,QAAQ,CAAC,KAAc,EAAA;AACzC,QAAA,IAAI,IAAI,CAAC,MAAM,EAAE;AACf,YAAA,IAAI,CAAC,MAAM,CAAC,QAAQ,GAAG,KAAK,CAAC;SAC9B;KACF;;;AAGD,IAAA,IAAW,GAAG,GAAA;AACZ,QAAA,OAAO,IAAI,CAAC,MAAM,EAAE,GAAG,IAAI,EAAE,CAAC;KAC/B;IACD,IAAoB,GAAG,CAAC,KAAa,EAAA;AACnC,QAAA,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;KACpB;AACM,IAAA,MAAM,CAAC,GAAkB,EAAA;AAC9B,QAAA,IAAI,IAAI,CAAC,MAAM,EAAE;AACf,YAAA,IAAI,CAAC,MAAM,CAAC,GAAG,GAAG,GAAG,CAAC;SACvB;KACF;IAQD,eAAe,GAAA;QACb,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,KAAI;AACtB,YAAA,IAAI,CAAC,MAAM,GAAG,IAAI,WAAW,CAAC,IAAI,CAAC,SAAS,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC;AAClE,YAAA,cAAc,CAAC,IAAI,CAAC,MAAM,EAAE,aAAa,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AAC9E,iBAAA,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,iBAAiB,EAAE,KAAK,CAAC,CAAC,CAAC;AACxE,YAAA,cAAc,CAAC,IAAI,CAAC,MAAM,EAAE,aAAa,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AAC9E,iBAAA,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,WAAW,EAAE,KAAK,CAAC,CAAC,CAAC;AAClE,YAAA,cAAc,CAAC,IAAI,CAAC,MAAM,EAAE,oBAAoB,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AACrF,iBAAA,SAAS,CAAC,CAAC,CAAC,YAAY,CAAC,KAAK,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,kBAAkB,EAAE,YAAY,CAAC,CAAC,CAAC;AACvF,YAAA,cAAc,CAAC,IAAI,CAAC,MAAM,EAAE,YAAY,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AAC7E,iBAAA,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC,CAAC;AAC/D,YAAA,cAAc,CAAC,IAAI,CAAC,MAAM,EAAE,cAAc,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AAC/E,iBAAA,SAAS,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,YAAY,EAAE,MAAM,CAAC,CAAC,CAAC;AACrE,YAAA,cAAc,CAAC,IAAI,CAAC,MAAM,EAAE,oBAAoB,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AACrF,iBAAA,SAAS,CAAC,CAAC,CAAC,YAAY,CAAC,KAAK,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,kBAAkB,EAAE,YAAY,CAAC,CAAC,CAAC;AACvF,YAAA,cAAc,CAAC,IAAI,CAAC,MAAM,EAAE,gBAAgB,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AACjF,iBAAA,SAAS,CAAC,CAAC,CAAC,QAAQ,CAAC,KAAK,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,cAAc,EAAE,QAAQ,CAAC,CAAC,CAAC;AAC7E,SAAC,CAAC,CAAC;KACJ;IAED,WAAW,GAAA;AACT,QAAA,IAAI,CAAC,MAAM,EAAE,OAAO,EAAE,CAAC;KACxB;AA9JU,IAAA,SAAA,IAAA,CAAA,IAAA,GAAA,EAAA,CAAA,kBAAA,CAAA,EAAA,UAAA,EAAA,QAAA,EAAA,OAAA,EAAA,QAAA,EAAA,QAAA,EAAA,EAAA,EAAA,IAAA,EAAA,oBAAoB,wCAIrB,UAAU,EAAA,EAAA,EAAA,KAAA,EAAA,EAAA,CAAA,UAAA,EAAA,CAAA,EAAA,MAAA,EAAA,EAAA,CAAA,eAAA,CAAA,SAAA,EAAA,CAAA,CAAA,EAAA;AAJT,IAAA,SAAA,IAAA,CAAA,IAAA,GAAA,EAAA,CAAA,oBAAA,CAAA,EAAA,UAAA,EAAA,QAAA,EAAA,OAAA,EAAA,QAAA,EAAA,IAAA,EAAA,oBAAoB,ymBCrBjC,wBAAsB,EAAA,MAAA,EAAA,CAAA,EAAA,CAAA,EAAA,CAAA,CAAA,EAAA;;2FDqBT,oBAAoB,EAAA,UAAA,EAAA,CAAA;kBANhC,SAAS;AACE,YAAA,IAAA,EAAA,CAAA,EAAA,QAAA,EAAA,cAAc,cAGZ,IAAI,EAAA,QAAA,EAAA,wBAAA,EAAA,CAAA;;0BAMb,MAAM;2BAAC,UAAU,CAAA;kEAYP,KAAK,EAAA,CAAA;sBAAjB,KAAK;gBAUO,MAAM,EAAA,CAAA;sBAAlB,KAAK;gBAOW,cAAc,EAAA,CAAA;sBAA9B,MAAM;gBAGM,WAAW,EAAA,CAAA;sBAAvB,KAAK;gBAKW,iBAAiB,EAAA,CAAA;sBAAjC,MAAM;gBAiBM,MAAM,EAAA,CAAA;sBAAlB,KAAK;gBAKW,YAAY,EAAA,CAAA;sBAA5B,MAAM;gBAMM,IAAI,EAAA,CAAA;sBAAhB,KAAK;gBAKW,UAAU,EAAA,CAAA;sBAA1B,MAAM;gBAOM,YAAY,EAAA,CAAA;sBAAxB,KAAK;gBAKW,kBAAkB,EAAA,CAAA;sBAAlC,MAAM;gBAMM,KAAK,EAAA,CAAA;sBAAjB,KAAK;gBAKW,WAAW,EAAA,CAAA;sBAA3B,MAAM;gBAca,QAAQ,EAAA,CAAA;sBAA3B,KAAK;gBAUc,GAAG,EAAA,CAAA;sBAAtB,KAAK;gBAUI,kBAAkB,EAAA,CAAA;sBAA3B,MAAM;gBAEiB,SAAS,EAAA,CAAA;sBAAhC,SAAS;uBAAC,WAAW,CAAA;;;AE1JxB;;AAEG;;;;"}